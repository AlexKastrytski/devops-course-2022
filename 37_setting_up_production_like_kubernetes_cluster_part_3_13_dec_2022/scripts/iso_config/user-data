#cloud-config
vyos_config_commands:
  - set firewall group network-group RFC1918 network '10.0.0.0/8'
  - set firewall group network-group RFC1918 network '172.16.0.0/12'
  - set firewall group network-group RFC1918 network '192.168.0.0/16'
  - set firewall interface eth0 in
  - set firewall interface eth0 local name 'OUTSIDE-LOCAL'
  - set firewall interface eth0 out name 'INSIDE-OUT'
  - set firewall name INSIDE-OUT
  - set firewall name INSIDE-OUT default-action 'drop'
  - set firewall name INSIDE-OUT rule 10 action 'accept'
  - set firewall name INSIDE-OUT rule 10 state established 'enable'
  - set firewall name INSIDE-OUT rule 10 state related 'enable'
  - set firewall name INSIDE-OUT rule 20 action 'accept'
  - set firewall name INSIDE-OUT rule 20 description 'accept internet'
  - set firewall name INSIDE-OUT rule 20 destination group network-group '!RFC1918'
  - set firewall name OUTSIDE-LOCAL default-action 'drop'
  - set firewall name OUTSIDE-LOCAL rule 10 action 'accept'
  - set firewall name OUTSIDE-LOCAL rule 10 state established 'enable'
  - set firewall name OUTSIDE-LOCAL rule 10 state related 'enable'
  - set firewall name OUTSIDE-LOCAL rule 31 action 'accept'
  - set firewall name OUTSIDE-LOCAL rule 31 destination port '22'
  - set firewall name OUTSIDE-LOCAL rule 31 protocol 'tcp'
  - set firewall name OUTSIDE-LOCAL rule 31 state new 'enable'
  - set interfaces ethernet eth0 address '10.44.99.74/20'
  - set interfaces ethernet eth0 description 'OUTSIDE'
  - set interfaces ethernet eth0 vif 10 address '10.10.0.1/24'
  - set interfaces ethernet eth0 vif 10 description 'INSIDE'
  - set interfaces loopback lo
  - set nat source rule 100 outbound-interface 'eth0'
  - set nat source rule 100 source address '10.10.0.0/24'
  - set nat source rule 100 translation address 'masquerade'
  - set protocols static route 0.0.0.0/0 next-hop '10.44.111.1'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 default-router '10.10.0.1'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 name-server '10.10.0.1'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 domain-name 'vyos.net'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 lease '86400'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 range 0 start '10.10.0.115'
  - set service dhcp-server shared-network-name LAN subnet 10.10.0.0/24 range 0 stop '10.10.0.210'
  - set service dns forwarding cache-size '0'
  - set service dns forwarding listen-address '10.10.0.1'
  - set service dns forwarding allow-from '10.10.0.0/24'
  - set service dns forwarding system 
  - set service ssh port '22'
  - set system host-name 'vyos-router'
  - set system login user k3s-user authentication encrypted-password '$6$v9K8.6blexeeA9sL$0mTfOHVPGJATWDIgZscVd0TGLFHee45rZTsgeHd4luHsFo51Q33A968HdwGA6uw4ObG4QdLvlwNMlI6pABgR51'
  - set system login user k3s-user authentication public-keys Adam key 'AAAAB3NzaC1yc2EAAAADAQABAAABgQDINWD9ztR8Zq/dGjGENWlMyjgvqBCy2cAoOg4ztB2w7YDA1JVObP4MDzBJnl+VD/6HvcjAjtC6n9AzaDG1odGHCzGY8Up1qR8me6W+XUPKS1Fkq3LQ7fg8Cza5uH45azPELA0myA4Mkodxw+9XLkn3wVSF1oEv8m9LP7c6qDXsEMuVaELUYgDYqBBTvQddUGfU/nSmRUpoLfCjnZ8NkXFzXyX3J/esnsHXKQBI9XKTMpmwPWmvCtK873IH3aplclZVIWlL7emrilt3cEM2oGe171TcFLF+ZE7945CDbrUIdpBc58fVyGdOJYqOJXyGvlFVZvyGuvjZIXtZG1wCAK7BU+euWTWxA3z1sbFbZMJPNEQnptCT/iP/Da/FLegtmnIOANpE52Y+5h7hRyZvfyQXVWf5YX9KkpNO4pdYsXKBKv9jm7MiENATLsYs5NtpC5GNgFRWg1OLiFU2gqD+C/fH9k8GoCpaLqgBPYdKFzXpwBsCuUsMJAG4u1Y8fJWJJus= tolik@DESKTOP-D8C0475'
  - set system login user k3s-user authentication public-keys Adam type 'ssh-rsa'
  - set system login user k3s-user full-name '“Adam”'
  - set system login user vyos authentication encrypted-password '$6$W0BFodB2nd6pKA8h$iaTGVGe5yPwDCbQnqgcthS4ftBMQ8vAoVq/77Ojf4ufGWA4ux4zYa0IuImxijExZ8CbV0enEO0kqonZmiB1H/0'
  - set system login user vyos authentication plaintext-password ''
  - set system ntp server 1.pool.ntp.org
  - set system ntp server 2.pool.ntp.org
  - set system name-server '10.44.111.1'
